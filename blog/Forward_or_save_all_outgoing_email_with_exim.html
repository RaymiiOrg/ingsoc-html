
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Forward or save outgoing email with Exim - Raymii.org</title>
        <!-- <link href="/s/inc/css/custom-first.css" rel="stylesheet" />-->
        <link href="/s/inc/css/marx.css" rel="stylesheet"  />
        <!-- <link href="/s/inc/css/custom.css" rel="stylesheet" title="custom" />-->
        <script src="/s//inc/js/instant.js" type="text/javascript"></script> 
        <script src="/s//inc/js/toc.js" type="text/javascript"></script> 
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org <img src="/s/inc/img/resistor-50.png"></a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>
                </small>
            </header>
          

    <h2 class='headheader' id='main'>Forward or save outgoing email with Exim</h2><p><small>Published: 16-12-2015 | Author: Remy van Elst | <a href="Forward_or_save_all_outgoing_email_with_exim.txt" class="link">Text only version of this article</small></a></p><div class='ad'>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- voorartikel -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:728px;height:90px"
                                 data-ad-client="ca-pub-7993642564731324"
                                 data-ad-slot="6172324376"></ins>
                            <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div><br><div id="toc"><h3>Table of Contents</h3></div><hr><div id="contents"><p>I have a specific server where requirements state that all outgoing email should
be saved for archival and auditing purposes. The server uses the Exim mail
transfer agent, which makes this easy to configure. The outgoing email is also
forwarded to an off-site mailbox, both for backup and easy consulting. This
captures all outgoing email, sent by PHP scripts or cronjobs, or user accounts
that send via exim. This tutorial also shows how to forward or save all outgoing
email for a specific domain.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean
VPS. With this link you&#39;ll get $100 credit for 60 days). (referral link)</a></p>

<h3>Exim configuration</h3>

<p>There are two things that need to be configured. The system filter and the
specific transport. If you only want to forward emails and not save them to the
filesystem, the transport section is not needed.</p>

<p>Edit your exim configuration and add these lines at the top:</p>

<pre><code># /etc/exim.conf top
system_filter = /etc/system_filter.exim
system_filter_directory_transport = local_copy_outgoing
</code></pre>

<p>Add these lines lower in the configuration, in your transports section:</p>

<pre><code># /etc/exim.conf transpors section
local_copy_outgoing:
  driver = appendfile
  delivery_date_add
  envelope_to_add
  return_path_add
  group = mail
  user = mail
  mode = 0660
  maildir_format = true
  create_directory = true
</code></pre>

<p>Change the <code>mail</code> user to the specific user account on your system exim runs at.
It could be named <code>exim</code>. You can check that with the <code>getent passwd</code> command.</p>

<p>To configure the actual saving and filtering create or edit the
<code>/etc/system_filter.exim</code> file. The below snippets should be placed in that
file, according to what you&#39;re trying to acomplish.</p>

<p>To save all outgoing mail from a specific domain to a maildir folder in
<code>/var/mail/</code>:</p>

<pre><code>if $sender_address_domain is example.tld
then
unseen save /var/mail/example.tld/mailarchive/.${tr{$sender_address}{.}{_}}.outgoing/
endif
</code></pre>

<p>Forward all outgoing from specific domain to specific email address:</p>

<pre><code>if $sender_address_domain is example.tld
then
unseen deliver othermailbox@otherdomain.com
endif
</code></pre>

<p>Forward ALL outgoing mail to email address:</p>

<pre><code>unseen deliver othermailbox@otherdomain.com
</code></pre>

<p>Save ALL outgoing email to maildir folder:</p>

<pre><code>unseen save /var/mail/${tr{$sender_address_domain}{.}{_}}/mailarchive/${tr{$sender_address}{.}{_}}.outgoing/
</code></pre>

<p>The files are saved in a maildir structure:</p>

<pre><code>ls -la /var/mail/example.tld/mailarchive/example\@example.tld.outgoing/new/
total 16
-rw-rw---- 1 mail mail 1632 Dec 15 20:31 1450207897.H829447P10443.example.tld
drwx------ 5 mail mail 4096 Dec 15 20:31 ..
-rw-rw---- 1 mail mail 1747 Dec 15 20:33 1450207983.H51962P10484.example.tld
drwx------ 2 mail mail 4096 Dec 15 20:33 .
</code></pre>

<p>You can check the <a href="http://www.exim.org/exim-html-3.30/doc/html/filter_34.html">exim documentation</a> for more variables you can use in this
filter document.</p>
Tags: <a href="../tags/blog.html" class="link">blog</a>, <a href="../tags/dovecot.html" class="link">dovecot</a>, <a href="../tags/email.html" class="link">email</a>, <a href="../tags/exim.html" class="link">exim</a>, <a href="../tags/filter.html" class="link">filter</a>, <a href="../tags/forward.html" class="link">forward</a></div><br/><footer><br/>
                <form role="search" action="https://encrypted.google.com/search"
                style="min-width:250px;max-width:300px;">
                    <div class="form-group">
                      <input type="hidden" name="as_sitesearch" value="raymii.org">
                      <input type="hidden" name="as_qdr" value="all">
                      <input type="text" name="as_q" class="form-control" placeholder="Search">
                    </div>
                  </form>
                <br>
                <p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                <a href="/s/static/About.html">About</a><br />
            
    </footer>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-3704876-6');
    </script>
     
    </body>
    </html>
    