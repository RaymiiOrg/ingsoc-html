
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Chrome 68 is depcrecating HPKP (HTTP Public Key Pinning) - Raymii.org</title>
        <link href="/s/inc/css/marx.css" rel="stylesheet"  />
        <script src="/s//inc/js/instant.js"></script> 
        <script src="/s//inc/js/toc.js"></script> 
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org 
                        <img src="/s/inc/img/resistor-50.png" alt="Logo (IEC resistor symbol)">
                    </a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>
                </small>
            </header>
          
    <h2 class='headheader' id='main'>Chrome 68 is depcrecating HPKP (HTTP Public Key Pinning)</h2>
<p><small>Published: 12-06-2018 | Author: Remy van Elst | <a href="Chrome_68_is_deprecating_HPKP.txt" class="link">Text only version of this article</small></a>
</p>
<div class='ad'>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- voorartikel -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:728px;height:90px"
                                 data-ad-client="ca-pub-7993642564731324"
                                 data-ad-slot="6172324376"></ins>
                            <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div><br><div id="toc">
<h3>Table of Contents</h3>
</div>
<hr>
<div id="contents">
<h3>HPKP removed from Chrome 68</h3>

<p><img src="https://raymii.org/s/inc/img/chrome_68.png" alt=""></p>

<p>In 2014 I <a href="https://raymii.org/s/articles/HTTP_Public_Key_Pinning_Extension_HPKP.html">published an article on HPKP</a>, http public key pinning. It allows
a site operator to send a public key in an http header, forcing the browser to
only connect when that header is found. It was ment to redice the risk of a
compromised certificate authority (since any CA can create a certificate for any
website). Quite secure, but it was often wrongly configured, forgotten until
certificates expired and there were some security issues like a false pin. Late
2017 Google announced that HPKP would be removed in Chrome 68 and that version
is released now, so HPKP is no longer supported.</p>

<p>A certificate authority, like Comodo, because they are trusted by every browser, can issue a certificate for any site (so google.com, raymii.org). But, the Netherlands Government (<a href="https://en.wikipedia.org/wiki/PKIoverheid">Staat der Nederlanden</a>) or the <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=408949">Hong Kong Post office</a> (China government) are trusted as well, thus are also able to issue a certificate for google.com. Now, there are all kinds of rules prohibiting that, but as <a href="https://raymii.org/s/blog/How_I_got_a_valid_SSL_certificate_for_my_ISPs_main_website.html">I&#39;ve shown</a> by getting a certificate for a website I don&#39;t own, just as <a href="http://web.archive.org/web/20180612111006/https://arstechnica.com/information-technology/2015/03/man-who-obtained-windows-live-cert-said-his-warnings-went-unanswered/">this guy for Microsoft Live.fi</a>, that it is prohibited by rules doesn&#39;t mean it is not technically possible. HPKP was meant to prevent that, by hardcoding a certificate for your site into a browser.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean
VPS. With this link you&#39;ll get $100 credit for 60 days). (referral link)</a></p>

<p>The <a href="https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/he9tr7p3rZ8/eNMwKPmUBAAJ">Google development announcement can be found here</a>, where they describe
and discuss the intent to remove the feature from chrome.</p>

<p><a href="http://web.archive.org/web/20180612110541/https://www.zdnet.com/article/google-chrome-is-backing-away-from-public-key-pinning-and-heres-why/">ZDNET</a> has an article going into more detail on what goes wrong when you
forgot about Key Pinning when a certificate expires:</p>

<blockquote>
<p>This scenario happened to <a href="https://www.smashingmagazine.com/be-afraid-of-public-key-pinning/">Smashing Magazine</a> when it was updating an
expiring SSL certificate. It enabled HPKP and set the policy for 365 days. After
rolling out new valid certificates, all browsers with the old HPKP policy
couldn&#39;t visit the site. Also, the new HPKP policy did nothing to update the old
one.</p>
</blockquote>

<h3>Replacement for HPKP, Expect-CT header?</h3>

<p>Google wants the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT">Expect-CT</a> header to replace HPKP. This header allows web
host operators to instruct user agents (browsers) to expect valid Signed
Certificate Timestamps (SCTs) to be served on connections to these hosts. When
configured in enforcement mode, user agents (UAs) will remember that hosts
expect SCTs and will refuse connections that do not conform to the UAs
Certificate Transparency policy.</p>

<p>There is no automatic detection of invalid certificates or rouge certificates.
As far as I understand you must configure and monitor the CT logs yourself to
find rouge certificates. I use <a href="https://ctadvisor.lolware.net/">this site</a> and get emails when a certificate
for a certain domain is found.</p>

<p><a href="http://web.archive.org/web/20180612100401/https://threatpost.com/google-to-ditch-public-key-pinning-in-chrome/128679/">This page</a> has a little bit more on the replacement:</p>

<blockquote>
<p>By combining Expect-CT with active monitoring for relevant domains, which a
growing number of CAs and third-parties now provide, site operators can
proactively detect misissuance in a way that HPKP does not achieve, while also
reducing the risk of misconfiguration and avoiding the risk of hostile pinning,
(Chris) Palmer said.</p>
</blockquote>

<p>Google&#39;s Certificate Transparency project is an open framework for monitoring
and auditing SSL certificates. The goal behind the project is detection of mis-
issued/malicious certificates and identification of rogue Certificate
Authorities.</p>

<p>Read more about the <a href="http://web.archive.org/web/20180612095804/http://httpwg.org/http-extensions/expect-ct.html">Expect-CT header in the RFC</a>. To read more about
Certificate Transparency, <a href="http://www.certificate-transparency.org/how-ct-works">check the site here</a>.</p>

<p>As I&#39;m unsure on how the actual header works, for example what defines when an
error is given, I&#39;m not recommending it yet, until I&#39;ve done more research.</p>

<h3>Removing HPKP on raymii.org</h3>

<p>I removed HPKP about half a year ago from the servers <a href="https://raymii.org/s/software/Sparkling_Network.html">hosting raymii.org</a>.
First by setting the <code>max-age</code> portion of the header to <code>0</code>, that tells existing
browsers that have HPKP cached to invalidate the known time. Otherwise, when
changing the certificate, the browser would still have old information thus
giving errors.</p>

<p>After 4 months, I actually changed the webserver configuration to remove the
HPKP headers:</p>

<pre><code>$ curl -I https://raymii.org
HTTP/2 200 
server: nginx/1.10.3 (Ubuntu)
date: Tue, 12 Jun 2018 09:39:01 GMT
content-type: text/html
content-length: 376
last-modified: Tue, 05 May 2015 17:21:00 GMT
etag: &quot;5548fbfc-178&quot;
expires: Thu, 12 Jul 2018 09:39:01 GMT
cache-control: max-age=2592000
strict-transport-security: max-age=63072000; includeSubdomains; preload
referrer-policy: origin
x-xss-protection: 1; mode=block
coffee: Black
tea: Earl-Gray; Hot
x-frame-options: DENY
x-content-type-options: nosniff
x-ua-compatible: IE=Edge,chrome=1
cache-control: public
accept-ranges: bytes
</code></pre>

<p>As you can see, no <code>Public-Key-Pins</code> header. If you have HPKP and want to remove
it, make sure to first set the time to <code>0</code> and let that run for a few months.</p>
Tags: <a href="../tags/apache.html" class="link">apache</a>
, <a href="../tags/blog.html" class="link">blog</a>
, <a href="../tags/expect-ct.html" class="link">expect-ct</a>
, <a href="../tags/hpkp.html" class="link">hpkp</a>
, <a href="../tags/https.html" class="link">https</a>
, <a href="../tags/lighttpd.html" class="link">lighttpd</a>
, <a href="../tags/nginx.html" class="link">nginx</a>
, <a href="../tags/security.html" class="link">security</a>
, <a href="../tags/ssl.html" class="link">ssl</a>
, <a href="../tags/tls.html" class="link">tls</a>
</div>
<br/>
<footer>
<br/>
                <form role="search" action="https://encrypted.google.com/search"
                style="min-width:250px;max-width:300px;">
                    <div class="form-group">
                      <input type="hidden" name="as_sitesearch" value="raymii.org">
                      <input type="hidden" name="as_qdr" value="all">
                      <input type="text" name="as_q" class="form-control" placeholder="Search">
                    </div>
                  </form>
                <br>
                <p><small>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.</small></p>
    
    </footer>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-3704876-6');
    </script>
     
    </main>
    </body>
    </html>
    