
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Mount ISO and execute scripts on OpenVMS - Raymii.org</title>
        <!-- <link href="/s/inc/css/custom-first.css" rel="stylesheet" />-->
        <link href="/s/inc/css/marx.css" rel="stylesheet"  />
        <!-- <link href="/s/inc/css/custom.css" rel="stylesheet" title="custom" />-->
        <script src="/s//inc/js/instant.js" type="text/javascript"></script> 
        <script src="/s//inc/js/toc.js" type="text/javascript"></script> 
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org <img src="/s/inc/img/resistor-50.png"></a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>
                </small>
            </header>
          

    <h2 class='headheader' id='main'>Mount ISO and execute scripts on OpenVMS</h2><p><small>Published: 08-05-2018 | Author: Remy van Elst | <a href="OpenVMS_Mount_ISO_and_execute_scripts.txt" class="link">Text only version of this article</small></a></p><div class='ad'>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- voorartikel -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:728px;height:90px"
                                 data-ad-client="ca-pub-7993642564731324"
                                 data-ad-slot="6172324376"></ins>
                            <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div><br><div id="toc"><h3>Table of Contents</h3></div><hr><div id="contents"><p><a href="https://raymii.org/s/tags/openvms.html"><img src="https://raymii.org/s/inc/img/ovmsdec.png" alt="openvms"></a></p>

<p>(You can read all my OpenVMS articles by <a href="https://raymii.org/s/tags/openvms.html">clicking the picture above</a>)</p>

<p>I&#39;m playing around with OpenVMS on Alpha using <a href="https://raymii.org/s/blog/The_sad_state_of_Alpha_emulators_for_OpenVMS.html">an emulator</a>, but was not
able to copy paste in my Hobbyist License. I suspect Putty pasting too quickly,
so I had to get the license script on the OpenVMS, without using the network. In
this article you&#39;ll learn some OpenVMS filesystem history, how OpenVMS handles
line endings and in the end I get my license installed by creating an ISO with
the script on it.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean
VPS. With this link you&#39;ll get $100 credit for 60 days). (referral link)</a></p>

<h3>-SYSTEM-W-DATAOVERUN, data overrun</h3>

<p>When pasting in my ISO using simh and a VAX system, I had no issues. When trying
it on the Alpha and putty, it errors out:</p>

<pre><code>%DCL-W-IVVERB, unrecognized command verb - check validity and spelling
 \$\
$ $ /ISSUER=DEC -
%DCL-W-NOCOMD, no command on line - reenter with alphabetic first character
$ /AUTHORIZATION=H
%RMS-F-RER, file read error
-SYSTEM-W-DATAOVERUN, data overrun
</code></pre>

<p>On a few forums it was suggested to create an ISO with the license script on it,
mount that and execute the script from there. Since the installed system has no
network yet (I&#39;m having a lot of issues with Windows and bridging in Virtualbox)
I cannot just copy over the file via FTP.</p>

<h3>Create the ISO</h3>

<p>On Ubuntu and Debian you can <code>apt-get install genisoimage</code>. Place the License
PAK script in a new folder, in my case the folder is named <code>license</code>. The PAK
script is named <code>a.com</code>. Generate the ISO:</p>

<pre><code>genisoimage -V license -o a.iso license
</code></pre>

<p><code>-V license</code> is so that the ISO label is <code>license</code>.</p>

<p>Using your favorite emulator, couple this ISO to your OpenVMS installation and
boot up. I&#39;m using a trial version of <a href="https://raymii.org/s/blog/The_sad_state_of_Alpha_emulators_for_OpenVMS.html">AlphaVM Basic</a>, but FreeAXP is
available as well as is <a href="https://raymii.org/s/blog/Installing_the_es40_AlphaServer_emulator_0.18_on_Ubuntu_16.04_and_trying_to_install_openVMS_8.4_on_es40.html">es40</a>.</p>

<p>In the case of AlphaVM the disk drive is <code>DKA400</code>.</p>

<h3>OpenVMS mounts</h3>

<p>When OpenVMS is booted up, in my case it complains about the licenses:</p>

<pre><code> Welcome to OpenVMS (TM) Alpha Operating System, Version V8.4

Username: system
Password:
%LICENSE-I-NOLICENSE, no license is active for this software product
%LOGIN-S-LOGOPRCON, login allowed from OPA0:
   Welcome to OpenVMS (TM) Alpha Operating System, Version V8.4

$
</code></pre>

<p>Find out what your cdrom device is:</p>

<pre><code>$ SHOW DEVICE

Device                  Device           Error    Volume         Free  Trans Mnt
 Name                   Status           Count     Label        Blocks Count Cnt
REMY1$DKA0:             Mounted              0  REMY1          5419104   307   1
REMY1$DKA400:           Online               0
</code></pre>

<p>In my case <code>DKA400</code>. You can find more information by specifying it to the <code>SHOW
DEV</code> command:</p>

<pre><code>$ show device dka400 /full

Disk REMY1$DKA400:, device type EmuVM CDROM ISO image, is online, file-oriented
    device, shareable, available to cluster, error logging is enabled.

    Error count                    0    Operations completed                268
    Owner process                 &quot;&quot;    Owner UIC                      [SYSTEM]
    Owner process ID        00000000    Dev Prot            S:RWPL,O:RWPL,G:R,W
    Reference count                0    Default buffer size                 512
    Total blocks                 256    Sectors per track                   128
    Total cylinders                1    Tracks per cylinder                   2
</code></pre>

<p>Let&#39;s try my linux-mindedness and see if mounting is the same. First create a
folder to mount the device on:</p>

<pre><code>$ CREATE /DIR [.MNT]
</code></pre>

<p>Try to mount the device:</p>

<pre><code>$ MOUNT DKA400 [.MNT]
</code></pre>

<p>And nope, no luck this time:</p>

<pre><code>%MOUNT-I-OPRQST, incorrect volume label
%MOUNT-I-OPRQST, Please mount volume [.MNT] in device _REMY1$DKA400:
</code></pre>

<p>Different variations on this command with the ISO label did not help.</p>

<p>Looking around the OpenVMS <code>HELP</code> for mount I found the <code>OVERRIDE</code> option.</p>

<pre><code>$ HELP MOUNT /OVERRIDE
</code></pre>

<p>Snipping the relevant part:</p>

<pre><code> IDENTIFICATION Overrides processing of the volume identifier
                in the volume label. Use this keyword to mount
                a volume for which you do not know the label,
                or for an ISO 9660 volume whose label is not
                unique in the first 12 characters. Only the volume
                identifier field is overridden. Volume protection,
                if any, is preserved. The volume must be mounted
                /NOSHARE (either explicitly or by default).

                The /OVERRIDE=IDENTIFICATION qualifier is
                incompatible with the /GROUP and /SYSTEM
                qualifiers.
</code></pre>

<p>Let&#39;s try that since I&#39;m not able to figure out this volume label:</p>

<pre><code>$ MOUNT /OVERRIDE=IDENT DKA400
%MOUNT-I-WRITELOCK, volume is write locked
%MOUNT-I-CDROM_ISO, license: (1 of 1) , mounted on  _REMY1$DKA400:
</code></pre>

<p>Lets see if the <code>SHOW DEV</code> output shows it as mounted now?</p>

<pre><code>$ SHOW DEV DKA400 /FULL

Disk REMY1$DKA400:, device type EmuVM CDROM ISO image, is online, allocated,
    deallocate on dismount, mounted, software write-locked, file-oriented
    device, shareable, available to cluster, error logging is enabled.

    Error count                    0    Operations completed                267
    Owner process           &quot;SYSTEM&quot;    Owner UIC                      [SYSTEM]
    Owner process ID        00000216    Dev Prot            S:RWPL,O:RWPL,G:R,W
    Reference count                2    Default buffer size                 512
    Total blocks                 256    Sectors per track                   128
    Total cylinders                1    Tracks per cylinder                   2

    Volume label           &quot;license&quot;    Relative volume number                1
    Cluster size                   0    Transaction count                     1
    Free blocks                    0    Maximum files allowed                 0
    Extend quantity                0    Mount count                           1
    Mount status             Process    ACP process name           &quot;DKA400CACP&quot;

  Volume Status:  ISO 9660.
  Members of this volume set are REMY1$DKA400: (rvn 1).
</code></pre>

<p>So now for the easy part right? Go into the device folder and execute the
script. Can&#39;t go wrong here.</p>

<p>But oh yes we can go wrong. Lets see what happens if we <code>cd</code> (<code>SET DEFAULT</code> on
OpenVMS) into the device:</p>

<pre><code>$ SET DEFAULT _REMY1$DKA400:
$ DIR
%DIRECT-E-OPENIN, error opening REMY1$DKA400:[SYSMGR]*.*;* as input
-RMS-E-DNF, directory not found
-SYSTEM-W-BADIRECTORY, bad directory file format
</code></pre>

<p>Again an OpenVMS error message. Not sure why, but I guess I did something wrong.</p>

<h3>[000000], the Master File Directory</h3>

<p>Diving into some history <a href="https://books.google.nl/books?id=y0qhFDfU0iUC&amp;lpg=PA97&amp;ots=Ay0-FB1rD7&amp;dq=%5B000000%5D%20openvms&amp;hl=nl&amp;pg=PA97#v=onepage&amp;q=%5B000000%5D%20openvms&amp;f=false"></a> we find more on why our previous command did not
work. We did not execute it in the root directory of the device. On OpenVMS a
filesystem&#39;s root directory is <code>[000000]</code>.</p>

<p>The HP documentation is not very helpfull on this part. I had to go on my local
ebook seller and buy this book since Google Books doesn&#39;t allow copy pasting.
But, reading through it, it seems to be a good book for me. Shame it cost me EUR
30. A few hours of reading later I realised I was busy with an ISO mount.</p>

<p>Quoting verbatim:</p>

<blockquote>
<p>Files11 is the file system used by OpenVMS. As one might imagine, the file
system is that part of an operating system that controls the storage and
manipulation of files.</p>

<p>ODS2 stands for OnDisk Structure, Version 2. It describes the actual layout of
files on the disk, including all control information needed to interpret the
contents of the disk. Later versions of OpenVMS Alpha (and presumably, the
upcoming Itanium version) also support a newer Files11 structure level, ODS5.
ODS2 and ODS5 volumes may exist on the same system, so long as the system is
running a compatible version of OpenVMS.</p>

<p>On ODS2 disks, the toplevel directory is called [000000]. This toplevel
directory is also known as the &quot;MFD,&quot; or &quot;Master File Directory.&quot;</p>

<p>New users may find it curious that directory listings of the [000000]
directory include the file 000000.DIR. This is because the MFD includes an entry
for itself, making it appear that the MFD &quot;contains itself.&quot;</p>

<p>Why Call It 000000?</p>

<p>The unlikelysounding name 000000 has a historical basis. On much older Digital
systems, the directory name for each user took the form [gggmmm], where ggg was
the UIC group number for that user, and mmm was the member number. So,
<a href="also%20denoted%20%5B000,000%5D">000000</a> represented the MFD. (Try it: as of OpenVMS V7.3, the command
DIRECTORY [0,0] still works as a substitute for DIRECTORY [000000] if you have
the appropriate privileges.)</p>
</blockquote>

<p>(Duffy, M. (2003). Getting started with openVMS system management: a guide for
(new users. Boston: Digital Press, p. 76-78)</p>

<p>When we execute the command in the correct folder it does show my script:</p>

<pre><code>$ SET DEF _REMY1$DKA400:[000000]
$ DIR _REMY1$DKA400:[000000]

Directory _REMY1$DKA400:[000000]

A_COM.;1

Total of 1 file.
</code></pre>

<h3>Execute a DCL script</h3>

<p>From <a href="https://web.archive.org/web/20180507185324/http://h41379.www4.hpe.com/doc/84final/9996/9996pro_18.html">the documentation</a>:</p>

<blockquote>
<p>@ (Execute Procedure) Executes a command procedure or requests the command
interpreter to read subsequent command input from a specific file or device.</p>
</blockquote>

<p>So no <code>./</code> as in linux.</p>

<p>Do specify the version number, otherwise it will fail:</p>

<pre><code>$ @A_COM
%DCL-E-OPENIN, error opening REMY1$DKA400:[000000]A_COM.COM; as input
-RMS-E-FNF, file not found
</code></pre>

<p>My license script did fail nontheless:</p>

<pre><code>$ @A_COM.;1
%DCL-W-IVVERB, unrecognized command verb - check validity and spelling
 \RODUCT\
%DCL-W-IVVERB, unrecognized command verb - check validity and spelling
$\
%DCL-W-UNDSYM, undefined symbol - check validity and spelling
 \APR\
</code></pre>

<p>I re-downloaded my license PAK and created a new ISO. That did not help. I
suspected it had something to do with line endings as I was using Windows to
create the text file. Opening the file with <code>EDIT</code> comfirmed my suspicion:</p>

<p><img src="https://raymii.org/s/inc/img/openvms-license.png" alt=""></p>

<h3>Line endings</h3>

<p>A search around the web lead me to the <a href="https://web.archive.org/web/20180507190424/http://h41379.www4.hpe.com/wizard/wiz_3707.html">OpenVMS Wizard</a>. Read the page for
the full answer and explanation. I&#39;ve snipped the relevant parts here:</p>

<pre><code>This depends on the current format of the file.  The OpenVMS Wizard
assumes that the reason for the CR characters is that this is a STREAM
file copied from Microsoft MS-DOS or Microsoft Windows system, as this
is a common reason for seeing apparently extraneous CR characters embedded
within a file.

RMS recognises three types of stream files:

  1) STREAM_LF - in which records are delimited by an LF character
  2) STREAM_CR - in which records are delimited by a CR character
  3) STREAM    - in which records are delimited by an LF character,
             a CR+LF character pair, or an FF or VT character

Often, text files from MS-DOS or Windows systems will have records ending
with a CR+LF pair. When such a file is copied onto a VMS system as a
STREAM_LF file, the CR character becomes part of the data stream and
therefore will appear at the end of each record.

You can check if your file falls into this category with the following
two commands:

    $ DIRECTORY/FULL filespec

Check that the Record Format is Stream_LF:

    Record format:      Stream_LF, maximum 0 bytes, longest 0 bytes

and that the records contain a CR+LF pair. Ensure you dump sufficient
blocks to see the ends of a number of records

    $ DUMP/BLOCK=COUNT:1 filespec

31310962 65462031 300A0D38 312E3009 .0.18..01 Feb.11 000020
                  ^^^^

0A0D is a CR+LF pair (remember that the hex dump reads right to left!).

If your file satisfies BOTH these conditions, you have two choices for
removing the CR from your data. The first doesn&#39;t actually remove the
character, it just tells RMS that the CR is part of the record
delimiter:

    $ SET FILE/ATTRIBUTE=(RFM=STM) filespec

Note that this does not involve any conversion or copying of data. The
DIRECTORY/FULL command will now display the record format as:

    Record format:      Stream, maximum 0 bytes, longest 0 bytes

and applications reading the file will no longer &quot;see&quot; the embedded CR
character.

If you really must physically remove the CR character, you can now do
so with a simple CONVERT command:

    $ SET FILE/ATTRIBUTE=(RFM=STM) filespec
    $ CONVERT/FDL=SYS$INPUT filespec newfilespec
        RECORD
          FORMAT STREAM_LF
    $

The first command tells RMS that the record relimiter is CR+LF as before.
The second performs a conversion of the file to STREAM_LF format, so when
the new file is created, records will be delimited by a single LF character.
</code></pre>

<p>Since the CDROM is mounted read only we cannot change the file spec:</p>

<pre><code>$ SET FILE/ATTRIBUTE=(RFM=STM) A_COM.;1
%SET-E-READERR, error reading REMY1$DKA400:[000000]A_COM.;1
-SYSTEM-F-WRITLCK, write lock error
</code></pre>

<p>Copy the file over to your home folder:</p>

<pre><code>$ COPY A_COM.;1 SYS$LOGIN
</code></pre>

<p>Change to that folder:</p>

<pre><code>$ SET DEF SYS$LOGIN
</code></pre>

<p>Retry the command, which should work now:</p>

<pre><code>$ SET FILE/ATTRIBUTE=(RFM=STM) A_COM.;1
</code></pre>

<p>In my case, it now looks correct in the editor:</p>

<p><img src="https://raymii.org/s/inc/img/openvms-license2.png" alt=""></p>

<p>But would it actually execute?</p>

<pre><code>$ @A_COM.;1
</code></pre>

<p>Output:</p>

<pre><code>%SHOW-I-NOLICENSE, no licenses exist
%LICENSE-I-DISABLED, ACMS has been disabled
%LICENSE-W-NOENT, no license was loaded for this product - DEC ACMS
%LICENSE-I-ENABLED, ACMS  has been enabled
%LICENSE-I-LOADED, DEC ACMS was successfully loaded with 0 units
%SHOW-I-NOLICMATCH, no licenses match search criteria
[...]
%LICENSE-W-NOENT, no license was loaded for this product - DEC X500-DIRECTORY-SERVER
%LICENSE-I-ENABLED, X500-DIRECTORY-SERVER has been enabled
%LICENSE-I-LOADED, DEC X500-DIRECTORY-SERVER was successfully loaded with 0 units
Completion of PAK Load Command File....
</code></pre>

<p>Yay! It works and my licenses have been setup.</p>

<p>I can now check my activated licenses:</p>

<pre><code>$
$ SHOW LICENSE

Active licenses on node REMY1:

------- Product ID --------    ---- Rating ----- -- Version --
Product            Producer    Units Avail Activ Version Release    Termination
ACMS               DEC             0  0     100    0.0  (none)       1-APR-2019
ACMS-REM           DEC             0  0     100    0.0  (none)       1-APR-2019
ACMS-RT            DEC             0  0     100    0.0  (none)       1-APR-2019
[...]
VMSCLUSTER         DEC             0  0     100    0.0  (none)       1-APR-2019
VOLSHAD            DEC             0  0     100    0.0  (none)       1-APR-2019
X25                DEC             0  0     100    0.0  (none)       1-APR-2019
X25-CLIENT         DEC             0  0     100    0.0  (none)       1-APR-2019
X500-ADMIN-FACILIT DEC             0  0     100    0.0  (none)       1-APR-2019
X500-DIRECTORY-SER DEC             0  0     100    0.0  (none)       1-APR-2019
</code></pre>

<p>When it&#39;s not DNS it&#39;s line endings. In this small adventure I learned the
OpenVMS mount command with a few options. Furthermore, it&#39;s not only between
Windows and Linux that line-endings cause issues, even in OpenVMS.</p>
Tags: <a href="../tags/alpha.html" class="link">alpha</a>, <a href="../tags/blog.html" class="link">blog</a>, <a href="../tags/dec.html" class="link">dec</a>, <a href="../tags/decus.html" class="link">decus</a>, <a href="../tags/es40.html" class="link">es40</a>, <a href="../tags/itanium.html" class="link">itanium</a>, <a href="../tags/openvms.html" class="link">openvms</a>, <a href="../tags/pdp.html" class="link">pdp</a>, <a href="../tags/simh.html" class="link">simh</a>, <a href="../tags/vax.html" class="link">vax</a>, <a href="../tags/vms.html" class="link">vms</a></div><br/><footer><br/>
                <form role="search" action="https://encrypted.google.com/search"
                style="min-width:250px;max-width:300px;">
                    <div class="form-group">
                      <input type="hidden" name="as_sitesearch" value="raymii.org">
                      <input type="hidden" name="as_qdr" value="all">
                      <input type="text" name="as_q" class="form-control" placeholder="Search">
                    </div>
                  </form>
                <br>
                <p>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.
            
    </footer>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-3704876-6');
    </script>
     
    </body>
    </html>
    