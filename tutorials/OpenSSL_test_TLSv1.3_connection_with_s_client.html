
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>OpenSSL test TLSv1.3 connection and ciphersuites with s_client - Raymii.org</title>
        <!-- <link href="/s/inc/css/custom-first.css" rel="stylesheet" />-->
        <link href="/s/inc/css/marx.css" rel="stylesheet"  />
        <!-- <link href="/s/inc/css/custom.css" rel="stylesheet" title="custom" />-->
        <script src="/s//inc/js/instant.js" type="text/javascript"></script> 
        <script src="/s//inc/js/toc.js" type="text/javascript"></script> 
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org <img src="/s/inc/img/resistor-50.png"></a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>
                </small>
            </header>
          

    <h2 class='headheader' id='main'>OpenSSL test TLSv1.3 connection and ciphersuites with s_client</h2><p><small>Published: 28-04-2019 | Author: Remy van Elst | <a href="OpenSSL_test_TLSv1.3_connection_with_s_client.txt" class="link">Text only version of this article</small></a></p><div class='ad'>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- voorartikel -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:728px;height:90px"
                                 data-ad-client="ca-pub-7993642564731324"
                                 data-ad-slot="6172324376"></ins>
                            <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div><br><div id="toc"><h3>Table of Contents</h3></div><hr><div id="contents"><p>This guide shows you how to test a server&#39;s TLSv1.3 connection and use specific
ciphersuites with the command line <code>s_client</code> client from the <code>OpenSSL</code> project.
With OpenSSL 1.1.1 you can use TLSv1.3. This guide covers the installation of
OpenSSL 1.1.1 on Ubuntu, testing the connection to a server and specific
ciphersuites. It also covers the big differences between TLSv1.3 and lower.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean
VPS. With this link you&#39;ll get $100 credit for 60 days). (referral link)</a></p>

<p>I often write about OpenSSL. <a href="https://raymii.org/s/tags/openssl.html">You can see all my OpenSSL articles here</a></p>

<h3>Installing OpenSSL 1.1.1 on Ubuntu 14.04, 16.04 or 18.04</h3>

<p>The version of OpenSSL that ships with Ubuntu 16.04, 14.04 and 18.04 (and 18.10
but thats not an LTS) is not new enough to support TLSv1.3. You can either
compile OpenSSL yourself (download the source, extract, <code>./configure</code>, <code>make</code>),
which I would recommend you to do. It&#39;s easy and provides a local binary for
testing, not a systemwide upgrade. Ubuntu versions are built around specific
versions, so upgrading a core security component might not be the greatest idea.
As in, I don&#39;t know what will break when you upgrade OpenSSL system wide.</p>

<p>Or, you can use a PPA and upgrade OpenSSL systemwide. I recommend you only do
this on a test system (one which you can afford to lose).</p>

<pre><code>add-apt-repository ppa:ondrej/apache2
apt-get update
apt-get install openssl
</code></pre>

<p>Again, I recommend you compile OpenSSL yourself.</p>

<p>You can check the OpenSSL version with this command:</p>

<pre><code>openssl version
</code></pre>

<p>My output:</p>

<pre><code>OpenSSL 1.1.1  11 Sep 2018 (Library: OpenSSL 1.1.1b  26 Feb 2019)
</code></pre>

<h3>Testing TLSv1.3 with s_client</h3>

<p>Using <code>s_client</code>, one can test a server via the command line. This is usefull if
you want to quickly test if your server is configured correctly, get the
certificate or show the chain, or use in scripts. It&#39;s a lot faster than using
an online tool.</p>

<p>The command to test a server with TLSv1.3 specificly is:</p>

<pre><code>echo | openssl s_client -tls1_3 -connect tls13.cloudflare.com:443
</code></pre>

<p>Append the <code>-showcerts</code> option to see the entire certificate chain that is sent.
<a href="https://raymii.org/s/articles/OpenSSL_manually_verify_a_certificate_against_a_CRL.html#Getting_the_certificate_chain">Here is a one liner to get the entire chain in a file</a></p>

<p>Example output for the cloudflare test server:</p>

<pre><code>CONNECTED(00000003)
depth=2 C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Certification Authority
verify return:1
depth=1 C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Domain Validation Secure Server CA 2
verify return:1
depth=0 OU = Domain Control Validated, OU = PositiveSSL Multi-Domain, CN = ssl412105.cloudflaressl.com
verify return:1
---
Certificate chain
 0 s:OU = Domain Control Validated, OU = PositiveSSL Multi-Domain, CN = ssl412105.cloudflaressl.com
   i:C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Domain Validation Secure Server CA 2
 1 s:C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Domain Validation Secure Server CA 2
   i:C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Certification Authority
 2 s:C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Certification Authority
   i:C = SE, O = AddTrust AB, OU = AddTrust External TTP Network, CN = AddTrust External CA Root
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIGkzCCBXugAwIBAgIRANJUlZPU4vFKFXext2DSsSswDQYJKoZIhvcNAQELBQAw
[...]
1OrH66uB5EdBbYFjiAFoMkaeCNcxz7gPmzXBLg8bapzoLy0F7MHoUphWFRVgG0WX
k5V11S6JgA==
-----END CERTIFICATE-----
subject=OU = Domain Control Validated, OU = PositiveSSL Multi-Domain, CN = ssl412105.cloudflaressl.com

issuer=C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Domain Validation Secure Server CA 2

---
No client certificate CA names sent
Peer signing digest: SHA256
Peer signature type: RSA-PSS
Server Temp Key: X25519, 253 bits
---
SSL handshake has read 5138 bytes and written 324 bytes
Verification: OK
---
New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384
Server public key is 2048 bit
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
Early data was not sent
Verify return code: 0 (ok)
---
DONE
</code></pre>

<h4>Specific ciphersuites</h4>

<p>In TLSv1.3 the meaning of ciphersuites changed. The new ciphersuites are defined
differently and do not specify the certificate type (e.g. RSA, DSA, ECDSA) or
the key exchange mechanism (e.g. DHE or ECHDE). The OpenSSL tooling has a new
option on the commandline for specifying TLSv1.3 ciphers (<code>ciphersuites</code>):</p>

<pre><code>openssl s_client -help
[...]
-cipher val                Specify TLSv1.2 and below cipher list to be used
-ciphersuites val          Specify TLSv1.3 ciphersuites to be used
</code></pre>

<p>To test a server with one or more specific TLSv1.3 ciphersuites, use the
<code>-ciphersuites</code> commandline flag. First check which specific ciphersuites are
supported by your openssl version with this command:</p>

<pre><code>openssl ciphers -v | grep TLSv1.3
</code></pre>

<p>Example output:</p>

<pre><code>TLS_AES_256_GCM_SHA384  TLSv1.3 Kx=any      Au=any  Enc=AESGCM(256) Mac=AEAD
TLS_CHACHA20_POLY1305_SHA256 TLSv1.3 Kx=any      Au=any  Enc=CHACHA20/POLY1305(256) Mac=AEAD
TLS_AES_128_GCM_SHA256  TLSv1.3 Kx=any      Au=any  Enc=AESGCM(128) Mac=AEAD
</code></pre>

<p>So, to test if a server supports the <code>TLS_AES_256_GCM_SHA384</code> ciphersuite, use
the following command:</p>

<pre><code>echo | openssl s_client -tls1_3 -ciphersuites &#39;TLS_AES_256_GCM_SHA384&#39; -connect tls13.cloudflare.com:443
</code></pre>

<p>In the output under the connection information (below the certificates), you
will see this if it succeeds:</p>

<pre><code>New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384
</code></pre>

<p>Or:</p>

<pre><code>New, TLSv1.3, Cipher is TLS_CHACHA20_POLY1305_SHA256
</code></pre>

<p>To test multiple ciphers, provide them in client preferred order, seperated by a
colon (<code>:</code>):</p>

<pre><code>echo | openssl s_client -tls1_3 -ciphersuites &#39;TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&#39; -connect tls13.cloudflare.com:443
</code></pre>

<p>Output:</p>

<pre><code>New, TLSv1.3, Cipher is TLS_CHACHA20_POLY1305_SHA256
</code></pre>

<p>The server will, if it supports the ciphersuite, use the clients preferred
cipher.</p>

<p>If you enable TLSv1.3 in Apache (or any OpenSSL using program) and configure
specific ciphersuites, you must explicitly enable specific TLSv1.3 ciphersuites,
the first three are included in <code>DEFAULT</code>. Otherwise a connection will fail.</p>

<p><a href="https://github.com/openssl/openssl/issues/5065">This was a deliberate decision</a> by the <a href="https://github.com/openssl/openssl/issues/5057">OpenSSL team</a>.</p>

<h3>Differences with TLSv1.2 and below</h3>

<p>Citing the <a href="http://web.archive.org/web/20190428143322/https://www.openssl.org/blog/blog/2017/05/04/tlsv1.3/">OpenSSL blog here verbatim</a>:</p>

<ul>
<li><p>TLSv1.3 is a major rewrite of the specification. There was some debate as to whether it should really be called TLSv2.0m but TLSv1.3 it is. There are major changes and some things work very differently. A brief, incomplete, summary of some things that you are likely to notice follows:</p></li>
<li><p>There are new ciphersuites that only work in TLSv1.3. The old ciphersuites cannot be used for TLSv1.3 connections.</p></li>
<li><p>The new ciphersuites are defined differently and do not specify the certificate type (e.g. RSA, DSA, ECDSA) or the key exchange mechanism (e.g. DHE or ECHDE). This has implications for ciphersuite configuration.</p></li>
<li><p>Clients provide a &quot;key_share&quot; in the ClientHello. This has consequences for &quot;group&quot; configuration. Sessions are not established until after the main handshake has been completed. There may be a gap between the end of the handshake and the establishment of a session (or, in theory, a session may not be established at all). This could have impacts on session resumption code.</p></li>
<li><p>Renegotiation is not possible in a TLSv1.3 connection</p></li>
<li><p>More of the handshake is now encrypted.</p></li>
<li><p>More types of messages can now have extensions (this has an impact on the custom extension APIs and Certificate Transparency)</p></li>
<li><p>DSA certificates are no longer allowed in TLSv1.3 connections</p></li>
</ul>
Tags: <a href="../tags/ca.html" class="link">ca</a>, <a href="../tags/certificate.html" class="link">certificate</a>, <a href="../tags/crl.html" class="link">crl</a>, <a href="../tags/ocsp.html" class="link">ocsp</a>, <a href="../tags/openssl.html" class="link">openssl</a>, <a href="../tags/pki.html" class="link">pki</a>, <a href="../tags/revocation.html" class="link">revocation</a>, <a href="../tags/ssl.html" class="link">ssl</a>, <a href="../tags/tls.html" class="link">tls</a>, <a href="../tags/tlsv1.3.html" class="link">tlsv1.3</a>, <a href="../tags/tutorials.html" class="link">tutorials</a></div><br/><footer><br/>
                <form role="search" action="https://encrypted.google.com/search"
                style="min-width:250px;max-width:300px;">
                    <div class="form-group">
                      <input type="hidden" name="as_sitesearch" value="raymii.org">
                      <input type="hidden" name="as_qdr" value="all">
                      <input type="text" name="as_q" class="form-control" placeholder="Search">
                    </div>
                  </form>
                <br>
                <p><small>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.</small></p>
            
    </footer>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-3704876-6');
    </script>
     
    </body>
    </html>
    