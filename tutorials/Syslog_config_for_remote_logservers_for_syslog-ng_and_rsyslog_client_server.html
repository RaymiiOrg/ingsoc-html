
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Syslog configuration for remote logservers for syslog-ng and rsyslog, both client and server - Raymii.org</title>
        <link href="/s/inc/css/custom-first.css" rel="stylesheet" />
        <!-- <link href="/s/inc/css/light.css" rel="stylesheet"  />
        # <link href="/s/inc/css/custom.css" rel="stylesheet" title="custom" />
        # <script src="/s//inc/js/toc.js" type="text/javascript"></script> -->
        <script type="text/javascript">
            window.onload=function(){var n="",e=0;document.getElementById("contents").innerHTML=document.getElementById("contents").innerHTML.replace(/<h([\d])>([^<]+)<\/h([\d])>/gi,function(r,t,o,a){if(t!=a)return r;t>e?n+=new Array(t-e+1).join("<ol>"):t<e&&(n+=new Array(e-t+1).join("</ol>")),e=parseInt(t);var i=o.replace(/ /g,"_");return n+='<li><a href="#'+i+'">'+o+"</a></li>","<h"+t+'><a name="'+i+'">'+o+"</a></h"+a+">"}),e&&(n+=new Array(e+1).join("</ol>")),document.getElementById("toc").innerHTML+=n};
        </script>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <link href="inc/img/icons/iphone.png" rel="apple-touch-icon" />
        <link href="inc/img/icons/ipad.png" rel="apple-touch-icon" sizes="76x76" />
        <link href="inc/img/icons/iphone-retina.png" rel="apple-touch-icon" sizes="120x120" />
        <link href="inc/img/icons/ipad-retina.png" rel="apple-touch-icon" sizes="152x152" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        <a class="skip-main" href="#main">Skip to main content</a>
        <a id="top-of-page"></a>
        <div class="container-fluid ">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3 col-sm-3 max-200">
                        <div class="well well-none"> 
                            <h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org <img src="/s/inc/img/resistor-50.png"></a></h3>
                            <h6 class="headheader">Quis custodiet ipsos custodes?</h6>
                            <h6><a href="https://raymii.org/s/feed.xml">RSS Feed</a></h6>
                        </div>
          

    
    <form role="search" action="https://encrypted.google.com/search">
        <div class="form-group">
          <input type="hidden" name="as_sitesearch" value="raymii.org">
          <input type="hidden" name="as_qdr" value="all">
          <input type="text" name="as_q" class="form-control" placeholder="Search">
        </div>
      </form>
      <div class="menu"><ul class="nav nav-pills nav-stacked"><li><a href="/s/index.html" class="special-menu">Home</a></li><li class='bottom-spacing'><a href="/s/tags/all.html" class="special-menu">All Pages</a></li><li class='hideifsmall'><a href="/s/tags/articles.html" class="link">Articles</a></li>
<li class='hideifsmall'><a href="/s/tags/blog.html" class="link">Blog</a></li>
<li class='hideifsmall'><a href="/s/tags/tutorials.html" class="link">Tutorials</a></li>
<li class='hideifsmall'><a href="/s/tags/ansible.html" class="link">Ansible</a></li><li class='hideifsmall'><a href="/s/tags/openstack.html" class="link">Openstack</a></li><li class='hideifsmall'><a href="/s/tags/openvms.html" class="link">OpenVMS</a></li><li class='hideifsmall'><a href="/s/tags/pdp-8.html" class="link">PDP-8</a></li><li class='hideifsmall'><a href="/s/tags/monitoring.html" class="link">Monitoring</a></li><li class='hideifsmall'><a href="/s/tags/ubuntu.html" class="link">Ubuntu</a></li></ul>            
               <!-- advertisement start -->
                <a href="https://www.digitalocean.com/?refcode=7435ae6b8212"><img src="https://raymii.org/s/inc/img/banner_trans.png"></a><br>
                <a href="http://clients.inceptionhosting.com/aff.php?aff=083">Inception Hosting Affiliate Link</a><br />
                <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocean Affiliate Link, $10 free credit.</a><br />
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- Raymii-2 -->
                <ins class="adsbygoogle"
                     style="display:inline-block;width:200px;height:200px"
                     data-ad-client="ca-pub-7993642564731324"
                     data-ad-slot="9322003332"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <!-- advertisement end -->
                </div>
           </div>  
           <div class="col-md-8 col-sm-8"> 
                <div class="inner">
                <div id="main"></div>

           <h2 class='headheader' id='main'>Syslog configuration for remote logservers for syslog-ng and rsyslog, both client and server</h2><ul class="breadcrumb"><li><a href="../index.html" class="link">Home</a></li><li><a href="../tags/tutorials.html" class="link">Tutorials</a></li><li><a href="Syslog_config_for_remote_logservers_for_syslog-ng_and_rsyslog_client_server.html" class="link">Syslog configuration for remote logservers for syslog-ng and rsyslog, both client and server</a></li></ul><p><small>21-06-2018</small> | <small>Remy van Elst</small> | <a href="Syslog_config_for_remote_logservers_for_syslog-ng_and_rsyslog_client_server.txt" class="link">Text only version of this article</a></p><div class='ad'>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- voorartikel -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:728px;height:90px"
                                 data-ad-client="ca-pub-7993642564731324"
                                 data-ad-slot="6172324376"></ins>
                            <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div><br><div id="toc"><h3>Table of Contents</h3></div><hr><div id="contents"><p><img src="/s/inc/img/teletype_asr33.jpg"></p>

<blockquote>
<p>A Teletype ASR-33 printing system output</p>
</blockquote>

<p>Syslog is the protocol, format (and software) linux and most networking devices use to log messages. All kinds of messages, system, authentication, login and applications. There are multiple implementations of syslog, like syslog-ng and rsyslog. Syslog has the option to log to a remote server and to act as a remote logserver (that receives logs). With a remote logging server you can archive your logs and keep them secure (when a machine gets hacked, if root is compromised the logs on the machine are no longer trustworthy). This tutorial shows how to set up a syslog server with rsyslog and syslog-ng and shows how to setup servers as a syslog client (that log to a remote server) with syslog-ng and rsyslog.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean VPS. With this link you&#39;ll get a $5 VPS for 2 months free (as in, you get $10 credit). (referral link)</a>  </p>

<h3>Server: rsyslog</h3>

<p>rsyslog is the default syslog service on Ubuntu, Debian, OpenSUSE and CentOS (next to systemd&#39;s journald). The configuration syntax is simpler than syslog-ng&#39;s, but complex configuration is more clear in syslog-ng. Bottom line they both work just as well. The below steps are to be taken to setup rsyslog as a syslog service to receive syslogs.</p>

<p>Edit the following file:</p>

<pre><code>vim /etc/rsyslog.d/10-remote.conf 
</code></pre>

<p>Add the following:</p>

<pre><code>$ModLoad imudp
$UDPServerRun 514
$AllowedSender UDP, 192.0.2.0/24

$template RemoteStore, &quot;/var/log/remote/%HOSTNAME%/%timegenerated:1:10:date-rfc3339%&quot;
:source, !isequal, &quot;localhost&quot; -?RemoteStore
:source, isequal, &quot;last&quot; ~
</code></pre>

<p>This will allow all hosts in the subnet <code>192.0.2.0/24</code> to log to this machine. </p>

<p>Restart rsyslog to make the changes active:</p>

<pre><code>service rsyslog restart
</code></pre>

<p>The files will be placed in <code>/var/log/remote</code>, sorted on hostname. For example:</p>

<pre><code> ls -la /var/log/remote/server1.example.net/
</code></pre>

<p>Output:</p>

<pre><code>total 10G
drwxr-xr-x 2 syslog syslog 4.0K Jun 19 08:44 .
drwxr-xr-x 4 syslog syslog 4.0K Jun 13 13:54 ..
-rw-r----- 1 syslog adm    2.6G Jun 14 23:59 2018-06-14
-rw-r----- 1 syslog adm    2.5G Jun 15 23:59 2018-06-15
-rw-r----- 1 syslog adm    1.4G Jun 16 23:59 2018-06-16
-rw-r----- 1 syslog adm    1.3G Jun 17 23:59 2018-06-17
-rw-r----- 1 syslog adm    1.1G Jun 18 23:59 2018-06-18
-rw-r----- 1 syslog adm    1.5G Jun 19 16:23 2018-06-19
</code></pre>

<p>When you just configured a client, it will take some time (a few minutes) before the logs and folder appear under <code>/var/log/remote</code>. </p>

<h4>Logrotate</h4>

<p>As you can see logging can take up some space, I recommend to setup logrotate for this remote folder. You can do so on Ubuntu by creating the following logrotate config file:</p>

<pre><code>vim /etc/logrotate.d/remote
</code></pre>

<p>Contents:</p>

<pre><code>/var/log/remote/*/*
{
        rotate 90
        daily
        missingok
        compress
}
</code></pre>

<p>This will compress and rotate logs every day and keep them for 90 days (3 months). To test your config, use the following command:</p>

<pre><code>logrotate -d --force /etc/logrotate.d/remote
</code></pre>

<p>(that will rotate all your logs, don&#39;t CTRL+C it otherwise your log folder will be messed up)</p>

<p>You don&#39;t have to restart a service since logrotate is ran via cron (<code>/etc/cron.daily/logrotate</code>).</p>

<h3>Client: rsyslog (Ubuntu)</h3>

<p>On Ubuntu or any rsyslog server, to log to a remote syslogserver, add the following to <code>rsyslog.conf</code>:</p>

<pre><code>    *.*   @192.0.2.10:514
</code></pre>

<p>(Replace 192.0.2.10 with the IP or hostname of your syslog server)</p>

<p>The file can be either: </p>

<ul>
<li><code>/etc/rsyslog.conf</code></li>
<li><code>/etc/rsyslog.d/99-remote.conf</code></li>
</ul>

<p>Restart rsyslog to make the changes active:</p>

<pre><code>service rsyslog restart
</code></pre>

<h3>Server: syslog-ng</h3>

<p>syslog-ng is the default on older versions of SUSE Enterprise Linux and OpenSUSE next to systemd&#39;s journald and on <a href="https://raymii.org/s/tags/hp-ux.html">HP-UX</a>. Most older distro&#39;s use it as well, Debian, Fedora and Arch all had it as their default years ago.</p>

<p>To set up syslog-ng as a remote log server that can receive logs, edit the following file:</p>

<pre><code>vim /etc/syslog-ng/syslog-ng.conf
</code></pre>

<p>Add or edit:</p>

<pre><code>source net { udp(); };
destination remote { file(&quot;/var/log/remote/${FULLHOST}&quot;); };
log { source(net); destination(remote); };
</code></pre>

<p>This file can also be in <code>/etc/syslog-ng/conf.d/</code> under a different name. Restart syslog-ng to make the changes active:</p>

<pre><code>service syslog-ng restart
</code></pre>

<p>This will place the logfiles in <code>/var/log/remote</code>. As far as I could find in the documentation, there is no option to limit on subnet like rsyslog has in the above example. Use the firewall to allow access from different networks.</p>

<p>With syslog-ng it is also recommended to setup logrotate and compression. See the rsyslog server section on how to do that.</p>

<h3>Client: syslog-ng</h3>

<p>The setup for sending logs to a remote syslog server is simple. Edit the <code>syslog-ng.conf</code> file:</p>

<pre><code>vim /etc/syslog-ng/syslog-ng.conf
</code></pre>

<p>Add or edit the following:</p>

<pre><code>destination remote { network(&quot;192.0.2.10&quot; transport(&quot;udp&quot;) port(514)); };
</code></pre>

<p>Older versions do not support the <code>network()</code> syntax, you need to use the older <code>tcp()</code> or <code>udp()</code> syntax:</p>

<pre><code>destination remote { udp(&quot;192.0.2.10&quot; port(514)); };
</code></pre>

<p>In both cases, replace <code>192.0.2.10</code> with your logserver&#39;s IP. (Unless you are using <code>TEST-NET-1</code> of course).</p>

<p>This file can also be in <code>/etc/syslog-ng/conf.d/</code> under a different name. Restart syslog-ng to make the changes active:</p>

<pre><code>service syslog-ng restart
</code></pre>

<h3>What about systemd / journald?</h3>

<p>Systemd and journald are taking over every part of your linux system including logging. Most distro&#39;s supply a syslog service which journald (systemd&#39;s binary logging component) forwards logs to. If your system is not set up like that, you need to install either rsyslog or syslog-ng and tell journald to forward the logs to syslog:</p>

<pre><code>vim /etc/systemd/journald.conf 
</code></pre>

<p>Add or change:</p>

<pre><code>ForwardToSyslog=yes
</code></pre>

<p>Restart journald:</p>

<pre><code>systemctl restart systemd-journald
</code></pre>

<p>If your syslog-ng or rsyslog version is recent enough, all journald logs will now appear in syslog as well.</p>
</div><hr>Tags: <a href="../tags/hp-ux.html" class="link">hp-ux &nbsp;</a><a href="../tags/log.html" class="link">log &nbsp;</a><a href="../tags/logging.html" class="link">logging &nbsp;</a><a href="../tags/opensuse.html" class="link">opensuse &nbsp;</a><a href="../tags/rsyslog.html" class="link">rsyslog &nbsp;</a><a href="../tags/security.html" class="link">security &nbsp;</a><a href="../tags/sles.html" class="link">sles &nbsp;</a><a href="../tags/suse.html" class="link">suse &nbsp;</a><a href="../tags/syslog.html" class="link">syslog &nbsp;</a><a href="../tags/syslog-ng.html" class="link">syslog-ng &nbsp;</a><a href="../tags/tutorials.html" class="link">tutorials &nbsp;</a><div class="footer">
                <hr>
                <p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                <a href="/s/static/About.html">About</a><br />
                </div>
            </div>
        </div>
    </div>  
    </div>
    </div>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-3704876-6');
    </script>
     
    </body>
    </html>
    