
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Debian packages clean up commands - Raymii.org</title>
        <!-- <link href="/s/inc/css/custom-first.css" rel="stylesheet" />-->
        <link href="/s/inc/css/marx.css" rel="stylesheet"  />
        <!-- <link href="/s/inc/css/custom.css" rel="stylesheet" title="custom" />-->
        <script src="/s//inc/js/instant.js" type="text/javascript"></script> 
        <script src="/s//inc/js/toc.js" type="text/javascript"></script> 
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org <img src="/s/inc/img/resistor-50.png"></a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>
                </small>
            </header>
          

    <h2 class='headheader' id='main'>Debian packages clean up commands</h2><p><small>Published: 01-01-2010 | Author: Remy van Elst | <a href="Debian-apt-get-dpkg-packages-cleanup-commands.txt" class="link">Text only version of this article</small></a></p><div class='ad'>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- voorartikel -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:728px;height:90px"
                                 data-ad-client="ca-pub-7993642564731324"
                                 data-ad-slot="6172324376"></ins>
                            <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div><br><div id="toc"><h3>Table of Contents</h3></div><hr><div id="contents"><p>As all my servers run on Debian and I like to keep things clean, here are some
handy commands.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean
VPS. With this link you&#39;ll get $100 credit for 60 days). (referral link)</a></p>

<h5>Find large packages</h5>

<pre><code>dpkg --get-selections | cut -f1 | while read pkg; do dpkg -L $pkg | xargs -I&#39;{}&#39; bash -c &#39;if [ ! -d &quot;{}&quot; ]; then echo &quot;{}&quot;; fi&#39; | tr &#39;\n&#39; &#39;\000&#39; | du -c --files0-from - | tail -1 | sed &quot;s/total/$pkg/&quot;; done | sort -rn &gt; ~/packages.log.txt
</code></pre>

<p>If you run this as root, when its finished you will have a file in /root called
packages.log.txt which has all the packages from your system in it with the size
of the package and the files it uses:</p>

<pre><code>15312 perl-modules
14192 php5-cgi
12588 perl
12400 coreutils
12396 iso-codes
11232 aptitude
10684 binutils
9916 python2.5 
</code></pre>

<p>You can also use something like</p>

<pre><code>dpkg-query -Wf &#39;${Installed-Size}\t${Package}\n&#39; | sort -n 
</code></pre>

<p>but this also takes the size of databases and extra files.</p>

<h5>Remove config files</h5>

<p>If you uninstall stuff with apt-get remove sometimes debian does not removes
config files and they also take up space. Now you can just use apt-get purge but
I tend to forget that every time. This command lists all the packages which are
removed but still have config files on your system:</p>

<pre><code>dpkg --list | grep &#39;^rc &#39;

rc binutils     2.20.1-15           The GNU assembler, linker and binary utilities
rc dbus         1.2.24-3            simple interprocess messaging system
rc dpkg-dev     1.15.8.5            Debian package development tools
rc erlang-base  1:14.a-dfsg-2       Erlang/OTP virtual machine and base applications
rc fakeroot     1.14.4-1            Gives a fake root environment
</code></pre>

<p>Now, just to make sure check the output and then remove the config files with
this command:</p>

<pre><code>dpkg --list | grep &#39;^rcb&#39; | awk &#39;{ print $2 }&#39; | xargs dpkg -P
</code></pre>

<h5>Cleanup afterwards</h5>

<p>To save up some space via apt get you can use these commands:</p>

<pre><code>apt-get autoremove
apt-get clean 
</code></pre>

<p>autoremove removes unused dependencies, packages which were installed by other
packeges but which are no longer needed by your system. clean just removes all
the packages in the apt cache. You can also use autoclean but clean frees up
more space. This command shows all the packages which are installed on your
system because some package recommends it, but they are not actually
dependencies of packages:</p>

<pre><code>aptitude search &#39;?and( ?automatic(?reverse-recommends(?installed)), ?not(?automatic(?reverse-depends(?installed))) )&#39; 
</code></pre>

<p>can give something like this:</p>

<pre><code>i A apt-xapian-index    -   maintenance and search tools for a Xapian index of Debian packages 
i A exim4               -   metapackage to ease Exim MTA (v4) installation 
i A file                -   Determines file type using &quot;magic&quot; numbers 
i A heirloom-mailx      -   feature-rich BSD mail(1)  
</code></pre>

<p>Check the output and if needed remove them all:</p>

<pre><code>aptitude search &#39;?and( ?automatic(?reverse-recommends(?installed)), ?not(?automatic(?reverse-depends(?installed))) )&#39; | awk &#39;{ print $3 }&#39; | xargs dpkg -P
</code></pre>

<p>Here are some commands to sort files by size:</p>

<pre><code>du -h | grep ^[0-9.]*M | sort -rn
du -h | grep ^[0-9.]*G | sort -rn
</code></pre>
Tags: <a href="../tags/apt-get.html" class="link">apt-get</a>, <a href="../tags/aptitude.html" class="link">aptitude</a>, <a href="../tags/cleanup.html" class="link">cleanup</a>, <a href="../tags/debian.html" class="link">debian</a>, <a href="../tags/df.html" class="link">df</a>, <a href="../tags/dpkg.html" class="link">dpkg</a>, <a href="../tags/size.html" class="link">size</a>, <a href="../tags/tutorials.html" class="link">tutorials</a>, <a href="../tags/ubuntu.html" class="link">ubuntu</a></div><br/><footer><br/>
                <form role="search" action="https://encrypted.google.com/search"
                style="min-width:250px;max-width:300px;">
                    <div class="form-group">
                      <input type="hidden" name="as_sitesearch" value="raymii.org">
                      <input type="hidden" name="as_qdr" value="all">
                      <input type="text" name="as_q" class="form-control" placeholder="Search">
                    </div>
                  </form>
                <br>
                <p>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.
            
    </footer>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-3704876-6');
    </script>
     
    </body>
    </html>
    