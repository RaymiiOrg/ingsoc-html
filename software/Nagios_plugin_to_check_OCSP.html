
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Nagios plugin to check an OCSP server - Raymii.org</title>
        <!-- <link href="/s/inc/css/custom-first.css" rel="stylesheet" />-->
        <link href="/s/inc/css/marx.css" rel="stylesheet"  />
        <!-- <link href="/s/inc/css/custom.css" rel="stylesheet" title="custom" />-->
        <script src="/s//inc/js/instant.js" type="text/javascript"></script> 
        <script src="/s//inc/js/toc.js" type="text/javascript"></script> 
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org <img src="/s/inc/img/resistor-50.png"></a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>
                </small>
            </header>
          

    <h2 class='headheader' id='main'>Nagios plugin to check an OCSP server</h2><p><small>Published: 06-05-2013 | Author: Remy van Elst | <a href="Nagios_plugin_to_check_OCSP.txt" class="link">Text only version of this article</small></a></p><div class='ad'>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- voorartikel -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:728px;height:90px"
                                 data-ad-client="ca-pub-7993642564731324"
                                 data-ad-slot="6172324376"></ins>
                            <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div><br><div id="toc"><h3>Table of Contents</h3></div><hr><div id="contents"><p>This is a nagios plugin to check an OCSP server. It does so by having either a
PEM encoded certificate in the code, and the PEM encoded certificate of the
issuer in the code, or by using two given PEM files. This is sent to the OCSP
server and the response is then parsed to give the correct nagios result. It is
targeted at administrators who have their own OCSP and need to know when it is
not working.</p>

<p>This version has contributions from <a href="https://github.com/palli/">Pali Sigurdsson</a>.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean
VPS. With this link you&#39;ll get $100 credit for 60 days). (referral link)</a></p>

<h4>Download</h4>

<p><a href="https://github.com/RaymiiOrg/nagios">Download the plugin from my github</a><br>
<a href="https://raymii.org/s/inc/downloads/check_ocsp.sh">Download the plugin from raymii.org</a></p>

<h4>Usage</h4>

<p><code>./check_ocsp.sh</code>:</p>

<ul>
<li><code>-H host_name</code> - remote host to check</li>
<li><code>-P port</code> - port to use</li>
<li><code>--noverify</code> - Don&#39;t verify if certificate is valid</li>
<li><code>--max-age 4800</code> - alert if certificate is about to expire</li>
<li><code>--cert filename</code> - use this cert file instead of the hardcoded one</li>
<li><code>--issuer filename.pem</code> - use this issuer certificate instead of the hardcoded one</li>
<li><code>--verbose</code> - handy for troubleshooting, echos the exact openssl command used</li>
</ul>

<h4>Installation</h4>

<p>This guide covers the steps needed for Ubuntu 10.04/12.04 and Debian 6. It
should also work on other distro&#39;s, but make sure to modify the commands where
needed (package installation for example).</p>

<p>First make sure you have the required tools:</p>

<pre><code>apt-get install gawk grep bash sed wget curl openssl
</code></pre>

<p>Place the script on the nagios host (I&#39;ve placed it in <em>/etc/nagios/plugins/</em> ):</p>

<pre><code>wget -O */etc/nagios/plugins/check_ocsp_hard.sh http://raymii.org/s/inc/downloads/check_ocsp_hard.sh
</code></pre>

<p>Make sure that the script is executable:</p>

<pre><code>chmod +x /etc/nagios/plugins/check_ocsp_hard.sh
</code></pre>

<p>Now test it:</p>

<pre><code>/etc/nagios/plugins/check_ocsp_hard.sh
OK: OCSP up and running - status of certificate for raymii.org GOOD by OCSP: http://ocsp.comodoca.com/
</code></pre>

<h4>Nagios config</h4>

<p>Here&#39;s some example nagios config:</p>

<p>Lets create a command definition:</p>

<pre><code>define command{
    command_name    check_ocsp
    command_line    /etc/nagios-plugins/check_ocsp.sh -H $USER1$ -p $USER2$ --cert $USER3$ --issuer $USER4$
}
</code></pre>

<p>And a service check:</p>

<pre><code>define service {
        use                             generic-service
        host_name                       localhost
        service_description             OCSP check of $OCSP for $DOMAIN
        contact                         nagiosadmin                 
        check_command                   check_ocsp!raymii.org!443!/etc/ssl/certs/raymiiorg.pem!/etc/ssl/certs/comodo.pem
}
</code></pre>

<p>Or if you use a hardcoded certificate:</p>

<pre><code>define command{
    command_name    check_ocsp_hard
    command_line    /etc/nagios-plugins/check_ocsp.sh
}

define service {
        use                             generic-service
        host_name                       localhost
        service_description             OCSP check of $OCSP for $DOMAIN with hardcoded certificate
        contact                         nagiosadmin                 
        check_command                   check_ocsp_hard
}
</code></pre>
Tags: <a href="../tags/certificates.html" class="link">certificates</a>, <a href="../tags/dogtag.html" class="link">dogtag</a>, <a href="../tags/monitoring.html" class="link">monitoring</a>, <a href="../tags/nagios.html" class="link">nagios</a>, <a href="../tags/ocsp.html" class="link">ocsp</a>, <a href="../tags/openssl.html" class="link">openssl</a>, <a href="../tags/software.html" class="link">software</a>, <a href="../tags/ssl.html" class="link">ssl</a></div><br/><footer><br/>
                <form role="search" action="https://encrypted.google.com/search"
                style="min-width:250px;max-width:300px;">
                    <div class="form-group">
                      <input type="hidden" name="as_sitesearch" value="raymii.org">
                      <input type="hidden" name="as_qdr" value="all">
                      <input type="text" name="as_q" class="form-control" placeholder="Search">
                    </div>
                  </form>
                <br>
                <p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                <a href="/s/static/About.html">About</a><br />
            
    </footer>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-3704876-6');
    </script>
     
    </body>
    </html>
    